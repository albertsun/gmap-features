<!doctype html>
<html>
<head>
  <title>Sample gmap-features code</title>
  <style type="text/css">
    html, body, #map_canvas {
    margin: 0;
    padding: 0;
    height: 100%;
    }
</style>
</head>
<body>
<div id="map_canvas" style="width:100%;height:100%;"></div>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>

<script src="geom.js"></script>
<script src="feature.js"></script>
<script src="gmap-loadpolygons.js"></script>


<script type="text/javascript">
var map, features;
function initialize() {
    map = new google.maps.Map(document.getElementById("map_canvas"), {
        //center: new google.maps.LatLng(40.731368,-73.975071),
        center: new google.maps.LatLng(40.8765,-73.9095),
	zoom: 15,
	mapTypeId: google.maps.MapTypeId.ROADMAP,
	mapTypeControl: false,
	streetViewControl: false
    });
    $.get("../sampledata/data.kml", function(data) {

        var BLUES = ["#E9F6FF", "#B3D6FF", "#7BB1FF", "#4C89E0", "#4073BC", "#284A72"];

        /*
         * invoke load_polygons
         */
	features = gmap.load_polygons({
	    map: map,
	    data: data, //required. all other params are optional
            data_type: "kml", // 'json' is default. can also use 'kml' in which case pass the kml document as data as a string 
            getColor: function(data) {
                // runs in the scope of each feature. returns the color to set it to
                // has access to the data in this.fields
                var perc;
                if (data.totpop != 0) {
                    perc = Number(data.totpop_wnh)/Number(data.totpop);
                } else { perc = 0; }
                return BLUES[(Math.floor(perc * 5)) % 5]; /* maps [0,1) into 0 to 4. buckets of .2 */
            },
	    unselected_opts: {
                "fillOpacity": .75
            },
	    highlighted_opts: {
                strokeWeight: 3.0,
                strokeColor: "#FF0000"
            },
	    selected_opts: {
                strokeWeight: 2.0,
                strokeColor: "#0000FF"
            },
	    highlightCallback: function(e) {
		console.log("highlighted "+this.id);
	    },
	    selectCallback: function(e) {
		console.log(this.fields);
	    }
	});



    });
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</body>
</html>
